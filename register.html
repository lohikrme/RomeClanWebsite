<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/register.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
    <title>Document</title>
</head>
<body id="login">
    
<header>

    <h1>Tiamat Clan Website</h1>
    <ul class="menu-items-list">
        <li id="main-button"><a href="index.html">Main</a></li>
        <li id="events-button"><a href="events.html">Events</a></li>
        <li id="forum-button"><a href="forum.html">Forum</a></li>
        <li id="login-button"><a href="login.html">Log in!</a></li>
    </ul>

</header>

<form class="registerForm" action="scripts/registration.php" method="post" onsubmit="return checkPasswords()">
    <h2>Register here! </h2>

    <p class="registerTexts">Email Address: </p>

    <div>
        <label><i class="fas fa-envelope"></i></label>
        <input class="inputs" id="email-address-input" name="email" type="email" placeholder="warband.player@gmail.com"> 
    </div>

    <p class="registerTexts">Account name: </p>

    <div>
        <label><i class="fas fa-user"></i></label>
        <input class="inputs" id="account-name-input" name="name" type="text" placeholder="Totenflak"> 
    </div>

    <p class="registerTexts">Password: </p>
    
    <div>
        <label><i class="fas fa-lock"></i></label>
        <input class="inputs" id="password1-input" name="password" type="password" placeholder="12345" onkeyup="checkPasswords()"> 
    </div>

    <p class="registerTexts">Write password again: </p>

    <div>
        <label><i class="fas fa-lock"></i></label>
        <input class="inputs" id="password2-input" type="password" placeholder="12345" onkeyup="checkPasswords()"> 
    </div>

    <p id="captcha-text" class="registerTexts">Before you are registered, write the following code in the last input field: </p>

    <img id="captcha-image" src="scripts/captcha.php" alt="CAPTCHA">
    <br>
    <input id="captcha-input" type="text" placeholder="1A2B3C" name="captcha-code">
    <br>

    <button class="buttons1" id="register-button" type="submit">Register</button>
    <button class="buttons1" id="clear-button" type="reset">Clear</button> <br>
    <a class="buttons2" id="return-login-button" href="login.html">Back to login? </a>
</form> <!-- loginForm ends -->



<!-- next script compares that passwords are similar between each others and enough long and complex-->
<!-- adding color hints to users so they know to fix their passwords until they are ok-->
<!-- also the script uses Ajax to stay in the current register.html and only send data to php files-->
<script>
    function checkPasswords() {
        var password1IsValid = false;
        var passwordsAreValid = false;

        var password1 = document.getElementById("password1-input");
        var password2 = document.getElementById("password2-input");

        console.log(password1.value);
        console.log(password2.value);

        if (password1.value == "" && password2.value == "") {
            password1.style.backgroundColor = "transparent";
            password2.style.backgroundColor = "transparent";
        }

        else if (password1.value.length >= 10 && password1.value.match(/[a-z]/) && password1.value.match(/[A-Z]/) && password1.value.match(/[0-9]/)) {
                password1.style.backgroundColor = "green";
                password1IsValid = true;
        } 
        else {
                password1.style.backgroundColor = "red";
                password1IsValid = false;
        }

        if (password1IsValid && password1.value === password2.value) {
            password2.style.backgroundColor = "green";
            passwordsAreValid = true;
        }
        else if (password1IsValid && password1.value !== password2.value) {
            password2.style.backgroundColor = "red";
            passwordsAreValid = false;
        }

        return passwordsAreValid;
    }

    // if we would direct user to php files, we would write here here 'return passwordsAreValid'
    // but now we just listen when submit has been clicked, 
    // then check if passwords are ok, and then send data to server using AJAX
    document.getElementById('register-button').addEventListener('click', function(event) {
        if (checkPasswords()) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'scripts/registration.php', true);
            var formData = new FormData(document.querySelector('.registerForm'));
            xhr.send(formData);

            xhr.onload = function() {
                // if php file answers that received data is OK:
                if (xhr.status == 201) {
                    window.location.href = "registration-successful.html";
                } else {
                    alert("Registration was not successful! Probably your name or email was already taken. Other possible reasons are: name or email contained other special letters outside - _ . and @. If problem persists, contact support at 'rome.lh.bl@gmail.com'.");
                }
            }
        }

        // prevent standard send of form to avoid changing web page
        event.preventDefault();
    });
</script> <!-- scripts end which checks password and sends data forward-->

<!-- next will be the scripts that contain hidden alerts. they are activates from validateRegistration.php if issues are faced -->
<script>
    window.onload = function() {
        var isEmpty = document.getElementById('emptyName');
        if (isEmpty && isEmpty.value == 'true') {
            alert("Name is empty");
        }
    }
</script>

</body>
</html>